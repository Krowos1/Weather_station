#include <Wire.h>
#include <Adafruit_Sensor.h>
#include <Adafruit_BMP280.h>
#include <Adafruit_SSD1306.h> // Подключение библиотеки для OLED дисплея
#include <AHT10.h> // Подключение библиотеки для датчика влажности AHT10

#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64

// Инициализация объектов датчика BMP280, OLED дисплея и AHT10
Adafruit_BMP280 bmp;
Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, -1); // Используем I2C интерфейс
AHT10Class AHT10;

// Задаем массив для изображения "заставки"
static const uint8_t PROGMEM image_data_Saraarray[1024] = {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x01,0xC0,0x00,0x00,0x03,0x00,0x38,0x38,0x70,0x00,0x00,

    0x00,0x00,0x1E,0x3D,0xFE,0x07,0xF1,0xE3,0xC7,0x8F,0xC0,0xFE,0x79,0xFE,0x00,0x00,

    0x00,0x00,0x1E,0x7D,0xFF,0x0F,0xF9,0xE3,0xC7,0x1F,0xE1,0xFF,0x73,0xFE,0x00,0x00,

    0x00,0x00,0x1E,0x79,0xFF,0x8F,0xFC,0xE3,0xCF,0x3F,0xF3,0xFF,0x73,0xFE,0x00,0x00,

    0x00,0x00,0x1E,0xF9,0xFF,0x9F,0x7C,0xE7,0xCF,0x7C,0xFB,0xEF,0x77,0xCE,0x00,0x00,

    0x00,0x00,0x1E,0xF1,0xE7,0x9E,0x3E,0xF7,0xEF,0x78,0x7B,0xC3,0x77,0x86,0x00,0x00,

    0x00,0x00,0x1F,0xE1,0xE7,0x9E,0x1E,0xF7,0xEF,0x78,0x7B,0xC0,0xE7,0x80,0x00,0x00,

    0x00,0x00,0x1F,0xE1,0xE7,0x9E,0x1E,0xF7,0xEE,0x78,0x7B,0xF0,0x67,0xE0,0x00,0x00,

    0x00,0x00,0x1F,0xC1,0xFF,0xBC,0x1E,0xF7,0xEE,0x78,0x7B,0xFC,0x07,0xF8,0x00,0x00,

    0x00,0x00,0x1F,0xC1,0xFF,0x3C,0x1E,0x77,0xEE,0x78,0x7B,0xFE,0x03,0xFC,0x00,0x00,

    0x00,0x00,0x1F,0xE1,0xFF,0x3C,0x1E,0x7F,0xFE,0x78,0x79,0xFF,0x03,0xFE,0x00,0x00,

    0x00,0x00,0x1F,0xE1,0xFE,0x3C,0x1E,0x7F,0xFE,0x78,0x78,0xFF,0x00,0xFE,0x00,0x00,

    0x00,0x00,0x1E,0xF1,0xFF,0x1E,0x1E,0x7E,0xFE,0x78,0x78,0x1F,0x00,0x3E,0x00,0x00,

    0x00,0x00,0x1E,0xF1,0xEF,0x1E,0x1E,0x7E,0x7C,0x78,0x7A,0x0F,0x04,0x1E,0x00,0x00,

    0x00,0x00,0x1E,0x79,0xEF,0x9E,0x3E,0x7E,0x7C,0x7C,0xFB,0x0F,0x06,0x1E,0x00,0x00,

    0x00,0x00,0x1E,0x79,0xE7,0x9F,0xFC,0x3E,0x7C,0x3F,0xF3,0xFF,0x07,0xFE,0x00,0x00,

    0x00,0x00,0x1E,0x3D,0xE7,0xCF,0xFC,0x3E,0x7C,0x3F,0xF3,0xFE,0x07,0xFE,0x00,0x00,

    0x00,0x00,0x1E,0x3D,0xE3,0xC7,0xF8,0x3C,0x7C,0x1F,0xE3,0xFE,0x07,0xFC,0x00,0x00,

    0x00,0x00,0x1E,0x3D,0xE3,0xE3,0xF0,0x3C,0x7C,0x0F,0xC1,0xFC,0x03,0xF8,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x3E,0x78,0x38,0xF9,0xFF,0x9F,0xE7,0x83,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x7F,0xFC,0x79,0xFF,0xFF,0xFF,0xE7,0xC3,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0xFF,0xBC,0x7B,0xFF,0xFF,0xFF,0xE7,0xC7,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0xFF,0xBC,0xF3,0xFF,0xFF,0xFF,0xE7,0xC7,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x01,0xF3,0x9E,0xF7,0xCE,0x3C,0x3C,0x07,0xC7,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x01,0xE0,0x9E,0xE7,0x82,0x3C,0x3C,0x07,0xEF,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x01,0xF0,0x1F,0xE7,0xC0,0x3C,0x3C,0x07,0xEF,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x01,0xFC,0x0F,0xE7,0xF0,0x3C,0x3F,0xE7,0xEF,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x01,0xFF,0x0F,0xC7,0xFC,0x3C,0x3F,0xE7,0xFF,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0xFF,0x87,0xC3,0xFE,0x3C,0x3F,0xE7,0xFF,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x7F,0x87,0x81,0xFE,0x3C,0x3F,0xE7,0xFF,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x3F,0x87,0x80,0xFE,0x3C,0x3C,0x07,0xFF,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x07,0x87,0x80,0x1E,0x3C,0x3C,0x07,0xBB,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x01,0x07,0x87,0x84,0x1E,0x3C,0x3C,0x07,0xBB,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x01,0xC7,0x87,0x87,0x1E,0x3C,0x3C,0x07,0xBB,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x01,0xFF,0x87,0x87,0xFE,0x3C,0x3F,0xE7,0x83,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x01,0xFF,0x87,0x87,0xFE,0x3C,0x3F,0xE7,0x83,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x01,0xFF,0x07,0x87,0xFC,0x3C,0x3F,0xE7,0x83,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x7E,0x03,0x81,0xF8,0x1C,0x1F,0xE7,0x01,0xC0,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,



};

void setup() {
  Serial.begin(9600);

  // Инициализация OLED дисплея
  if (!display.begin(SSD1306_SWITCHCAPVCC, 0x3C)) {
    Serial.println(F("SSD1306 allocation failed"));
    for (;;);
  }

  // Display the "заставка" for 3 seconds
  unsigned long startMillis = millis();
  while (millis() - startMillis < 5000) {
    display.clearDisplay();
    display.drawBitmap(0, 0, image_data_Saraarray, SCREEN_WIDTH, SCREEN_HEIGHT, SSD1306_WHITE);
    display.display();
  }
  display.clearDisplay();

  // Подключение датчика BMP280
  if (!bmp.begin(0x76)) {
    Serial.println("Could not find a valid BMP280 sensor, check wiring!");
    while (1);
  }

  if (AHT10.begin(0x38))                            // Инициализируем датчик с адресом 0x38
    Serial.println("AHT10 подключен.");            // Если удачно печатаем "AHT10 подключен."
  else {
    Serial.println("AHT10 не подключен.");         // Если не удачно печатаем "AHT10 не подключен."
    while (1);                                      // Заканчиваем выполнение
  }

  Serial.println(F("BMP280 and AHT10 test"));
}

void loop() {
  // Чтение данных с датчика BMP280
  float temperature = bmp.readTemperature();
  float pressure_pa = bmp.readPressure(); // Давление в паскалях
  float pressure_mmHg = pressure_pa * 0.00750062; // Преобразование к мм рт. ст.

  float T = AHT10.GetTemperature();                // Считываем показание температуры
  float H = AHT10.GetHumidity();                   // Считываем показание влажности
  float D = AHT10.GetDewPoint();                   // Считываем значение точки росы для данной влажности

  // Очистка и вывод данных на OLED дисплей
  display.clearDisplay();
  display.setTextSize(1); // Устанавливаем размер букв в один раз больше
  display.setTextColor(SSD1306_WHITE);
  display.setCursor(0, 0);
  display.print("Temperature: ");
  display.print(temperature, 1);
  display.print(" C");

  display.setCursor(0, 16);
  display.print("Pressure: ");
  display.print(pressure_mmHg, 2);
  display.print(" mmHg");

  display.setCursor(0, 32);
  display.print("Humidity: ");
  display.print(H, 1);
  display.print(" %");

  display.setCursor(0, 48);
  display.print("Dew Point: ");
  display.print(D, 1);
  display.print(" C");

  display.display();

  // Вывод данных в Serial Monitor
  Serial.print(F("Temperature = "));
  Serial.print(temperature);
  Serial.println(" *C");

  Serial.print(F("Pressure = "));
  Serial.print(pressure_mmHg);
  Serial.println(" mmHg");

  Serial.print(F("Humidity = "));
  Serial.print(H);
  Serial.println(" %");

  Serial.print(F("Dew Point = "));
  Serial.print(D);
  Serial.println(" C");

  delay(1000);
}
